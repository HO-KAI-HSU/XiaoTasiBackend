<!DOCTYPE html>
<html lang="en">
<head>

    <!-- start: Meta -->
    <meta charset="utf-8" />
    <title>SimpliQ - Flat & Responsive Bootstrap Admin Template</title>
    <meta name="description" content="SimpliQ - Flat & Responsive Bootstrap Admin Template." />
    <meta name="author" content="Łukasz Holeczek" />
    <meta name="keyword" content="SimpliQ, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina" />
    <!-- end: Meta -->
    <!-- start: Mobile Specific -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- end: Mobile Specific -->
    <!-- start: CSS -->
    <link href="/Scripts/css/bootstrap-datetimepicker.css" rel="stylesheet" />
    <link href="/Scripts/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/Scripts/css/bootstrap-select.css" rel="stylesheet" />
    <link href="/Scripts/css/bootstrap-select.min.css" rel="stylesheet" />
    <link href="/Scripts/css/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="/Scripts/css/style.min.css" rel="stylesheet" />
    <link href="/Scripts/css/style-responsive.min.css" rel="stylesheet" />
    <link href="/Scripts/css/retina.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.jqueryui.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/scroller/2.0.5/css/scroller.jqueryui.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css" rel="stylesheet" />
    <!-- end: CSS -->
    <!-- The HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <link id="ie-style" href="css/ie.css" rel="stylesheet">
    <![endif]-->
    <!--[if IE 9]>
        <link id="ie9style" href="css/ie9.css" rel="stylesheet">
    <![endif]-->
    <!-- start: Favicon and Touch Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/Scripts/ico/apple-touch-icon-144-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/Scripts/ico/apple-touch-icon-114-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/Scripts/ico/apple-touch-icon-72-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" href="/Scripts/ico/apple-touch-icon-57-precomposed.png" />
    <link rel="shortcut icon" href="/Scripts/ico/favicon.png" />
    <!-- end: Favicon and Touch Icons -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<body>
    <!-- start: Header -->
    <div class="navbar">
        <div class="navbar-inner">
            <div class="container-fluid">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".top-nav.nav-collapse,.sidebar-nav.nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a id="main-menu-toggle" class="hidden-phone open"><i class="icon-reorder"></i></a>
                <div class="row-fluid">
                    <a class="brand span2" href="index.html"><span>SimpliQ</span></a>
                </div>
                <!-- start: Header Menu -->
                <div class="nav-no-collapse header-nav">
                    <ul class="nav pull-right">
                        <!-- start: User Dropdown -->
                        <li class="dropdown">
                            <a class="btn account dropdown-toggle" data-toggle="dropdown" href="#">
                                <div class="user">
                                    <span class="hello">Welcome!</span>
                                    <span class="managerName"></span>
                                </div>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="dropdown-menu-title">

                                </li>
                                <li><a href="#"><i class="icon-user"></i> Profile</a></li>
                                <li><a href="#"><i class="icon-cog"></i> Settings</a></li>
                                <li><a href="#"><i class="icon-envelope"></i> Messages</a></li>
                                <li><a href="login.html"><i class="icon-off"></i> Logout</a></li>
                            </ul>
                        </li>
                        <!-- end: User Dropdown -->
                    </ul>
                </div>
                <!-- end: Header Menu -->

            </div>
        </div>
    </div>
    <!-- start: Header -->

    <div class="container-fluid-full">
        <div class="row-fluid">

            <!-- start: Main Menu -->
            <div id="sidebar-left" class="span2">

                <div class="row-fluid actions">

                    <input type="text" class="search span12" placeholder="..." />

                </div>

                <div class="nav-collapse sidebar-nav">
                    <ul class="nav nav-tabs nav-stacked main-menu">
                        <li>
                            <a class="dropmenu" href="#"><i class="icon-folder-close-alt"></i><span class="hidden-tablet"> 後台人員管理 </span> <span class="label">4</span></a>
                            <ul>
                                <li><a class="submenu" href="Staff"><i class="icon-hdd"></i><span class="hidden-tablet"> 帳號管理 </span></a></li>
                                <li><a class="submenu" href="Group"><i class="icon-envelope"></i><span class="hidden-tablet"> 群組管理 </span></a></li>
                                <li><a class="submenu" href="Permission"><i class="icon-tasks"></i><span class="hidden-tablet"> 權限管理 </span></a></li>
                                <li><a class="submenu" href="Log"><i class="icon-tasks"></i><span class="hidden-tablet"> 異動日誌 </span></a></li>
                            </ul>
                        </li>
                        <li>
                            <a class="dropmenu" href="#"><i class="icon-folder-close-alt"></i><span class="hidden-tablet"> 最新消息管理 </span> <span class="label">3</span></a>
                            <ul>
                                <li><a class="submenu" href="IndexBanner"><i class="icon-hdd"></i><span class="hidden-tablet"> 首頁Banner管理 </span></a></li>
                                <li><a class="submenu" href="LatestNews"><i class="icon-hdd"></i><span class="hidden-tablet"> 公告管理 </span></a></li>
                                <li><a class="submenu" href="LatestMediaNews"><i class="icon-hdd"></i><span class="hidden-tablet"> 媒體消息管理 </span></a></li>
                            </ul>
                        </li>
                        <li>
                            <a class="dropmenu" href="#"><i class="icon-folder-close-alt"></i><span class="hidden-tablet"> 地點管理 </span> <span class="label">2</span></a>
                            <ul>
                                <li><a class="submenu" href="Location"><i class="icon-hdd"></i><span class="hidden-tablet"> 地點管理 </span></a></li>
                                <li><a class="submenu" href="Boarding"><i class="icon-hdd"></i><span class="hidden-tablet"> 上車地點管理 </span></a></li>
                            </ul>
                        </li>
                        <li>
                            <a class="dropmenu" href="#"><i class="icon-folder-close-alt"></i><span class="hidden-tablet"> 行程管理 </span> <span class="label">3</span></a>
                            <ul>
                                <li><a class="submenu" href="Viewpoint"><i class="icon-hdd"></i><span class="hidden-tablet"> 景點管理 </span></a></li>
                                <li><a class="submenu" href="Hotel"><i class="icon-hdd"></i><span class="hidden-tablet"> 飯店管理 </span></a></li>
                                <li><a class="submenu" href="Travel"><i class="icon-hdd"></i><span class="hidden-tablet"> 行程管理 </span></a></li>
                            </ul>
                        </li>
                        <li>
                            <a class="dropmenu" href="#"><i class="icon-folder-close-alt"></i><span class="hidden-tablet"> 遊覽車訂位管理 </span> <span class="label">2</span></a>
                            <ul>
                                <li><a class="submenu" href="Transportation"><i class="icon-hdd"></i><span class="hidden-tablet"> 遊覽車管理 </span></a></li>
                                <li><a class="submenu" href="TransportTravel"><i class="icon-hdd"></i><span class="hidden-tablet"> 訂位管理 </span></a></li>
                            </ul>
                        </li>
                        <li>
                            <a class="dropmenu" href="#"><i class="icon-folder-close-alt"></i><span class="hidden-tablet"> 會員管理 </span> <span class="label">2</span></a>
                            <ul>
                                <li><a class="submenu" href="Member"><i class="icon-hdd"></i><span class="hidden-tablet"> 會員管理 </span></a></li>
                                <li><a class="submenu" href="Reservation"><i class="icon-hdd"></i><span class="hidden-tablet"> 訂位管理 </span></a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- end: Main Menu -->
            <!-- start: Content -->
            <div id="content" class="span10">
                <div class="row-fluid">
                    <div class="box span12">
                        <div class="box-header" data-original-title="">
                            <h2><i class="icon-user"></i><span class="break"></span>行程管理</h2>
                            <div class="box-icon">
                                <a class="btn-setting" id="addTravel"><i class="icon-plus"></i></a>
                                <a class="btn-setting" id="uploadBatchTravel"><i class="icon-cloud-upload"></i></a>
                            </div>
                        </div>
                        <div class="box-content">
                            <table id="travelListTable" class="table table-striped table-bordered bootstrap-datatable datatable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>行程類型</th>
                                        <th>行程名稱</th>
                                        <th>行程費用</th>
                                        <th>行程天數</th>
                                        <th>行程各梯次開始日期</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="travelList">
                                </tbody>
                            </table>
                        </div>
                    </div><!--/span-->

                </div><!--/row-->
            </div>
            <!-- end: Content -->

        </div><!--/fluid-row-->

        <div class="modal hide fade" id="addTravelModal" aria-hidden="true" style="display:none;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" id="closeTravelAdd">×</button>
                <h3>添增行程</h3>
            </div>
            <div class="modal-body">
                <div class="lowin-group">
                    <label>行程名稱</label>
                    <input type="text" name="travelName" class="addTravelName">
                </div>
                <div class="lowin-group">
                    <label>行程類型</label>
                    <select name="travelType" class="addTravelType"></select>
                </div>
                <div class="control-group">
                    <label class="control-label">旅遊上車地點類型</label>
                    <select name="travelBoardingType" class="addTravelBoardingType"></select>
                </div>
                <label>選擇客製化上車地點</label>
                <div class="lowin-group">
                    <select id="addTravelCustomBoardingIds" name="travelCustomBoardingIds" class="selectpicker show-tick form-control" multiple data-live-search="false">
                    </select>
                </div>
                <div class="lowin-group">
                    <label>行程內容</label>
                    <input type="text" name="travelContent" class="addTravelContent">
                </div>
                <div class="lowin-group">
                    <label>行程費用</label>
                    <input type="text" name="travelCost" class="addTravelCost">
                </div>
                <div class="lowin-group">
                    <label>行程人數限制</label>
                    <input type="text" name="travelNum" class="addTravelNum">
                </div>
                <div class="lowin-group">
                    <label>行程天數</label>
                    <input type="text" name="travelDateNum" class="addTravelDateNum">
                </div>
                <div class="lowin-group">
                    <label>行程開始時間</label>
                    <input type="datetime-local" name="travelStime" class="addTravelStime">
                </div>
                <div class="lowin-group">
                    <label>行程結束時間</label>
                    <input type="datetime-local" name="travelEtime" class="addTravelEtime">
                </div>
                <div class="lowin-group">
                    <label>行程開始日期選擇（可多選）</label>
                    <input type="text" id="travelDetailSdate" class="addTravelDetailSdate">
                </div>
                <div class="lowin-group">
                    <label>上傳圖片</label>
                    <input type="file" name="travelPicFile" class="addTravelPicFile" accept="image/gif, image/jpeg, image/png">
                </div>
                <div class="lowin-group">
                    <label>交通花費</label>
                    <input type="text" id="transportationInfo" class="addTransportationInfo">
                </div>
                <div class="lowin-group">
                    <label>食物花費</label>
                    <input type="text" id="eatInfo" class="addEatInfo">
                </div>
                <div class="lowin-group">
                    <label>住宿花費</label>
                    <input type="text" id="liveInfo" class="addLiveInfo">
                </div>
                <div class="lowin-group">
                    <label>行花費</label>
                    <input type="text" id="actionInfo" class="addActionInfo">
                </div>
                <div class="lowin-group">
                    <label>育樂花費</label>
                    <input type="text" id="insuranceInfo" class="addInsuranceInfo">
                </div>
                <div class="lowin-group">
                    <label>花費</label>
                    <input type="text" id="nearInfo" class="addNearInfo">
                </div>
            </div>
            <div class="modal-footer">
                <a class="btn" data-dismiss="modal" id="closeTravelAdd">取消新增</a>
                <a class="btn btn-primary" id="addTravel">添增</a>
            </div>
        </div>
        <div class="modal hide fade" id="uploadBatchTravelModal" aria-hidden="true" style="display:none;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" id="closeBatchTravelUpload">×</button>
                <h3>Excel旅遊批次上傳</h3>
            </div>
            <div class="modal-body">
                <div class="lowin-group">
                    <label>上傳Excel</label>
                    <input type="file" name="batchTravelFile" class="uploadBatchTravelFile" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
                </div>
            </div>
            <div class="modal-footer">
                <a class="btn" data-dismiss="modal" id="closeBatchTravelUpload">取消上傳</a>
                <a class="btn btn-primary" id="uploadBatchTravel">上傳</a>
            </div>
        </div>

        <div class="modal hide fade" id="travelInfoModal" aria-hidden="true" style="display:none;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" id="closeTravelEdit">×</button>
                <h3>行程資訊編輯</h3>
            </div>
            <div class="modal-body">
                <input type="hidden" name="id" class="editId">
                <div class="lowin-group">
                    <label>行程名稱</label>
                    <input type="text" name="travelName" class="editTravelName">
                </div>
                <div class="lowin-group">
                    <label>行程內容</label>
                    <input type="text" name="travelContent" class="editTravelContent">
                </div>
                <div class="lowin-group">
                    <label>行程費用</label>
                    <input type="text" name="travelCost" class="editTravelCost">
                </div>
                <div class="lowin-group">
                    <label>行程人數限制</label>
                    <input type="text" name="travelNum" class="editTravelNum">
                </div>
                <div class="lowin-group">
                    <label>行程天數</label>
                    <input type="text" name="travelDateNum" class="editTravelDateNum">
                </div>
                <div class="lowin-group">
                    <label>行程開始時間</label>
                    <input type="datetime-local" name="travelStime" class="editTravelStime">
                </div>
                <div class="lowin-group">
                    <label>行程結束時間</label>
                    <input type="datetime-local" name="travelEtime" class="editTravelEtime">
                </div>
                <div class="lowin-group">
                    <label>行程開始日期選擇（可多選）</label>
                    <input type="text" id="travelDetailSdate" class="editTravelDetailSdate">
                </div>
                <div class="lowin-group">
                    <label>交通花費</label>
                    <input type="text" id="transportationInfo" class="editTransportationInfo">
                </div>
                <div class="lowin-group">
                    <label>食物花費</label>
                    <input type="text" id="eatInfo" class="editEatInfo">
                </div>
                <div class="lowin-group">
                    <label>住宿花費</label>
                    <input type="text" id="liveInfo" class="editLiveInfo">
                </div>
                <div class="lowin-group">
                    <label>行花費</label>
                    <input type="text" id="actionInfo" class="editActionInfo">
                </div>
                <div class="lowin-group">
                    <label>育樂花費</label>
                    <input type="text" id="insuranceInfo" class="editInsuranceInfo">
                </div>
                <div class="lowin-group">
                    <label>花費</label>
                    <input type="text" id="nearInfo" class="editNearInfo">
                </div>
            </div>
            <div class="modal-footer">
                <a class="btn" data-dismiss="modal" id="closeTravelEdit">取消編輯</a>
                <a class="btn btn-primary" id="updateTravel">修改</a>
            </div>
        </div>


        <div class="modal hide fade" id="addTravelDetailModal" aria-hidden="true" style="display:none;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" id="closeTravelDetailAdd">×</button>
                <h3>添增行程明細</h3>
            </div>
            <div class="modal-body">
                <input type="hidden" name="id" class="editId">
                <div id="tabDetail">
                </div>
                <div class="modal-footer">
                    <a class="btn" data-dismiss="modal" id="closeTravelDetailAdd">取消新增</a>
                </div>
            </div>
        </div>

        <div class="clearfix"></div>

        <footer>
            <p>
                <span style="text-align:left;float:left">Copyright &copy; 2014.Company name All rights reserved.More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></span>
            </p>

        </footer>

    </div><!--/.fluid-container-->
    <!-- start: JavaScript-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/dataTables.jqueryui.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/scroller/2.0.5/js/dataTables.scroller.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.0/moment.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
    <!-- mark
    <script src="/Scripts/js/jquery-1.10.2.min.js"></script>
    <script src='/Scripts/js/jquery.dataTables.min.js'></script>
    <script src="/Scripts/js/bootstrap-select.js"></script>
    <script src="/Scripts/js/bootstrap-select.min.js"></script>
    <script src="/Scripts/js/bootstrap-datetimepicker.min.js"></script>
    mark-->
    <script src="/Scripts/angular.min.js"></script>
    <script src="/Scripts/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="/Scripts/js/jquery-ui-1.10.3.custom.min.js"></script>
    <script src="/Scripts/js/jquery.ui.touch-punch.js"></script>
    <script src="/Scripts/js/modernizr.js"></script>
    <script src="/Scripts/js/bootstrap.min.js"></script>
    <script src="/Scripts/js/jquery.cookie.js"></script>
    <script src='/Scripts/js/fullcalendar.min.js'></script>
    <script src="/Scripts/js/excanvas.js"></script>
    <script src="/Scripts/js/jquery.flot.js"></script>
    <script src="/Scripts/js/jquery.flot.pie.js"></script>
    <script src="/Scripts/js/jquery.flot.stack.js"></script>
    <script src="/Scripts/js/jquery.flot.resize.min.js"></script>
    <script src="/Scripts/js/jquery.flot.time.js"></script>
    <script src="/Scripts/js/jquery.chosen.min.js"></script>
    <script src="/Scripts/js/jquery.uniform.min.js"></script>
    <script src="/Scripts/js/jquery.cleditor.min.js"></script>
    <script src="/Scripts/js/jquery.noty.js"></script>
    <script src="/Scripts/js/jquery.elfinder.min.js"></script>
    <script src="/Scripts/js/jquery.raty.min.js"></script>
    <script src="/Scripts/js/jquery.iphone.toggle.js"></script>
    <script src="/Scripts/js/jquery.uploadify-3.1.min.js"></script>
    <script src="/Scripts/js/jquery.gritter.min.js"></script>
    <script src="/Scripts/js/jquery.imagesloaded.js"></script>
    <script src="/Scripts/js/jquery.masonry.min.js"></script>
    <script src="/Scripts/js/jquery.knob.modified.js"></script>
    <script src="/Scripts/js/jquery.sparkline.min.js"></script>
    <script src="/Scripts/js/counter.min.js"></script>
    <script src="/Scripts/js/raphael.2.1.0.min.js"></script>
    <script src="/Scripts/js/justgage.1.0.1.min.js"></script>
    <script src="/Scripts/js/jquery.autosize.min.js"></script>
    <script src="/Scripts/js/retina.js"></script>
    <script src="/Scripts/js/jquery.placeholder.min.js"></script>
    <script src="/Scripts/js/wizard.min.js"></script>
    <script src="/Scripts/js/core.min.js"></script>
    <script src="/Scripts/js/charts.min.js"></script>
    <script src="/Scripts/js/custom.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            var loginInfo = JSON.parse(localStorage.getItem('loginInfo'));
            var managerItem = `
                <span class="hello" > Welcome!</span >
                <span class="managerName">${loginInfo.name}</span >`;
            $(".user").html(managerItem);//要刷新的div

            if ($.fn.DataTable.isDataTable('#travelListTable')) {
                console.log("table true");
                var table = $('#travelListTable').DataTable({
                    destroy: true,
                    select: true,
                    language: {
                        emptyTable: "Not Travel Datas!"
                    },
                    ajax: {
                        serverSide: true,
                        processing: true,
                        url: "@Url.Action("getTravelList","Travel")",
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        dataType: "JSON"
                    },
                    rowId: 'travelId',
                    columns: [
                        { data: "travelId" },
                        {
                            data: "travelType", render: function (data, type, row, meta) {
                                return getTravelTypeName(data);
                            }
                        },
                        { data: "travelName" },
                        { data: "travelCost" },
                        { data: "travelDateNum" },
                        { data: "travelDetailSdate" },
                        {
                            data: "operation", render: function (data, type, row, meta) {
                                return `
								    <a class="btn btn-success" id="travelDetail">
										<i class="icon-zoom-in"></i>
									</a>
								    <a class="btn btn-info" id="addTravelDetail">
									    <i class="icon-plus"></i>
								    </a>
								    <a class="btn btn-info" id="editTravel">
									    <i class="icon-edit"></i>
								    </a>
								    <a class="btn btn-danger" id="deleteTravel">
									    <i class="icon-trash"></i>
								    </a>`;
                            }
                        }
                    ]
                });
                var travelTypeList = getTravelTypeData();
                var travelBoardingTypeList = getTravelBoardingTypeData();
                $(".addTravelType").html(travelTypeList);
                $(".addTravelBoardingType").html(travelBoardingTypeList);
            } else {
                console.log("table false");
            }

            var dates = new Array();
            function addDate(date) {
                if (jQuery.inArray(date, dates) < 0)
                    dates.push(date);
            }

            function removeDate(index) {
                dates.splice(index, 1);
            }

            function addOrRemoveDate(date) {
                var index = jQuery.inArray(date, dates);
                if (index >= 0)
                    removeDate(index);
                else
                    addDate(date);
            }


            function getCustomBoardingInitData() {
                var locationArr = JSON.parse(localStorage.getItem('locationArr'));
                var customBoardingArr = JSON.parse(localStorage.getItem('customBoardingArr'));
                $('#addTravelCustomBoardingIds option').remove();
                var select = $("#addTravelCustomBoardingIds");
                customBoardingArr.forEach(itemCustomBoarding => {
                    locationArr.forEach(itemLocation => {
                        if (itemCustomBoarding.locationId == itemLocation.locationId) {
                            var optionName = itemLocation.locationName + itemCustomBoarding.boardingDatetime;
                            select.append("<option value='" + itemCustomBoarding.boardingId + "'>"
                                + optionName + "</option>");
                        }
                    });
                });
                $('#addTravelCustomBoardingIds').selectpicker('val', '');
                $('#addTravelCustomBoardingIds').selectpicker('refresh');
            }

            $("select[name='travelBoardingType']").change(function () {
                var customBoardingFlag = $(".addTravelBoardingType").val();
                if (customBoardingFlag == "2") {
                    $.ajax({
                        url: "@Url.Action("getBoardingList","Boarding")",
                        type: "POST",
                        data: JSON.stringify({ customBoardingFlag: 1 }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "JSON",
                        success: function (data) {
                            customBoardingArr = data.data;
                            localStorage.setItem("customBoardingArr", JSON.stringify(customBoardingArr));
                            getCustomBoardingInitData();
                        }
                    })
                } else {
                    $('#addTravelCustomBoardingIds option').remove();
                    $('#addTravelCustomBoardingIds').selectpicker('val', '');
                    $('#addTravelCustomBoardingIds').selectpicker('refresh');
                }
            });

            $.ajax({
                url: "@Url.Action("getLocationList","Location")",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                success: function (data) {
                    locationArr = data.data;
                    localStorage.setItem("locationArr", JSON.stringify(locationArr));
                }
            })

            $.ajax({
                url: "@Url.Action("getHotelList", "Hotel")",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                success: function (data) {
                    hotelArr = data.data;
                    localStorage.setItem("travelHotelList", JSON.stringify(hotelArr));
                }
            })

            $.ajax({
                url: "@Url.Action("getViewpointList","Viewpoint")",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                success: function (data) {
                    viewpointArr = data.data;
                    localStorage.setItem("travelViewpointList", JSON.stringify(viewpointArr));
                }
            })

            function getTravelTypeName(travelType) {
                var travelName = "";
                switch (travelType) {
                    case 1: {
                        travelName = "一日旅遊";
                        break;
                    }
                    case 2: {
                        travelName = "多日旅遊";
                        break;
                    }
                    case 3: {
                        travelName = "離島旅遊";
                        break;
                    }
                    case 4: {
                        travelName = "包車旅遊";
                        break;
                    }
                    default: {
                        break;
                    }
                }
                return travelName;
            }

            function getTravelBoardingTypeName(travelType) {
                var travelName = "";
                switch (travelType) {
                    case 0: {
                        travelName = "正常班";
                        break;
                    }
                    case 1: {
                        travelName = "早班車";
                        break;
                    }
                    case 2: {
                        travelName = "客製化上車地點";
                        break;
                    }
                    default: {
                        break;
                    }
                }
                return travelName;
            }



           function getTravelDatailSelectInfo(dateNum, travelId) {
               let getTravelDatailInfoHtml = '';
               getTravelDatailInfoHtml += '<div class="tab" id="tabList">';
               for (var i = 0; i < dateNum; i++) {
                   getTravelDatailInfoHtml += `
					<a class="btn btn-info tablinks" id="tablinks" value="${travelId}${","}${i + 1}">
                        <input type="hidden" name="detailId" value="${travelId}${i + 1}">
						第${i + 1}天
					</a>`
               }
               getTravelDatailInfoHtml += '</div>';
               for (var i = 0; i < dateNum; i++) {
                   getTravelDatailInfoHtml += `
                    <div id="${travelId}${","}${i + 1}" class="tabcontent" style="display : none;">
                      <input type="hidden" name="travelDetailTravelId" class="travelDetailTravelId">
                      <input type="hidden" name="travelDetailTravelDay" class="travelDetailTravelDay">
                      <div class="lowin-group">
                          <h2>景點</h2>
                          <div name="travelDetailViewpoint" class="addTravelDetailViewpoint"></div>
                      </div>
                      <div class="lowin-group">
                          <h2>飯店</h2>
                          <div name="travelDetailHotel" class="addTravelDetailHotel"></div>
                      </div>
                      <div class="lowin-group">
                          <label>餐點</label>
                          <br/>
                          <label>早餐</label>
                          <input type="text" name="travelDetailBreakfast" class="addTravelDetailBreakfast">
                      </div>
                      <div class="lowin-group">
                          <label>中餐</label>
                          <input type="text" name="travelDetailLunch" class="addTravelDetailLunch">
                      </div>
                      <div class="lowin-group">
                          <label>晚餐</label>
                          <input type="text" name="travelDetailDinner" class="addTravelDetailDinner">
                      </div>
                      <a class="btn btn-primary" id="addTravelDayDetail">添增</a>
                    </div>`;
               }
               return getTravelDatailInfoHtml;
            }

            function getTravelHotelData(data, hotelId) {
                let travelHotelHtml = '';
                for (var travelHotelKey in data) {
                    if (data[travelHotelKey].hotelId == hotelId) {
                        travelHotelHtml += `${data[travelHotelKey].hotelName}  ${data[travelHotelKey].hotelAddress}  : <input type="checkbox" name="hotelIds[]" value="${data[travelHotelKey].hotelId}" class = "hotelIds" checked="yes"/><br />`;
                    } else {
                        travelHotelHtml += `${ data[travelHotelKey].hotelName}  ${data[travelHotelKey].hotelAddress}  : <input type="checkbox" name="hotelIds[]" value="${data[travelHotelKey].hotelId}" class = "hotelIds"/><br />`;
                    }
                }
                return travelHotelHtml;
            }

            function getTravelViewpointData(data, viewpointIdArr) {
                console.log(viewpointIdArr);
                console.log(data);
                let travelViewpointHtml = '';
                for (var travelViewpointKey in data) {
                    if (viewpointIdArr.indexOf(data[travelViewpointKey].viewpointId) > -1) {
                        travelViewpointHtml += `
                    ${ data[travelViewpointKey].viewpointTitle}  ${data[travelViewpointKey].viewpointAddress}  : <input type="checkbox" name="viewpointIds[]" value="${data[travelViewpointKey].viewpointId}" class = "viewpointIds" checked="yes"/><br />`;
                    } else {
                        travelViewpointHtml += `
                    ${ data[travelViewpointKey].viewpointTitle}  ${data[travelViewpointKey].viewpointAddress}  : <input type="checkbox" name="viewpointIds[]" value="${data[travelViewpointKey].viewpointId}" class = "viewpointIds"/><br />`;
                    }
                }
                return travelViewpointHtml;
            }

            function getTravelTypeData() {
                let locationHtml = '';
                locationHtml += `
                    <option value="1">一日行程</option>
                    <option value="2">多日行程</option>
                    <option value="3">離島行程</option>
                    <option value="4">包車行程</option>
                    `;
                return locationHtml;
            }

            function getTravelBoardingTypeData() {
                let boardingHtml = '';
                boardingHtml += `
                    <option value="0">正常班</option>
                    <option value="1">早班車</option>
                    <option value="2">客製化上車地點</option>
                    `;
                return boardingHtml;
            }

            function dateTimetransfar(dateTimeStr) {
                var dateVal = new Date(dateTimeStr);
                var day = dateVal.getDate().toString().padStart(2, "0");
                var month = (1 + dateVal.getMonth()).toString().padStart(2, "0");
                var hour = dateVal.getHours().toString().padStart(2, "0");
                var minute = dateVal.getMinutes().toString().padStart(2, "0");
                var sec = dateVal.getSeconds().toString().padStart(2, "0");
                var ms = dateVal.getMilliseconds().toString().padStart(3, "0");
                var inputDate = dateVal.getFullYear() + "-" + (month) + "-" + (day) + "T" + (hour) + ":" + (minute) + ":" + (sec) + "." + (ms);
                return inputDate;
            }

            $("#tabDetail").on('click', '#tablinks', async function () {
                var travelDetailId = $(this).attr("value");
                var travelDetailIdArr = travelDetailId.split(',');
                var viewpointSelectTmp = JSON.parse(localStorage.getItem('travelViewpointList'));
                var hotelSelectTmp = JSON.parse(localStorage.getItem('travelHotelList'));
                $(".travelDetailTravelId").val(travelDetailIdArr[0]);
                $(".travelDetailTravelDay").val(travelDetailIdArr[1]);
                var travelData = await getTravelInfo(travelDetailIdArr[0]);
                var travelDetailId1 = 0;
                if (travelData.travelDetailIdList[travelDetailIdArr[1] - 1] != null) {
                    var travelDetailId1 = travelData.travelDetailIdList[travelDetailIdArr[1] - 1].travelDetailId;
                }
                var travelDetailDetail = await getTravelDetailInfo(travelDetailId1);
                var hotelId = travelDetailDetail.hotelInfo.hotelId;
                var mealInfo = travelDetailDetail.mealInfo;
                var viewpointIdArr = new Array();
                if (travelDetailDetail.travelPicList.length > 0) {
                    for (var travelDetailKey in travelDetailDetail.travelPicList) {
                        var viewpoint = travelDetailDetail.travelPicList[travelDetailKey];
                        if (viewpoint != null && jQuery.inArray(viewpoint.travelPicId, viewpointIdArr) < 0) {
                            viewpointIdArr.push(viewpoint.travelPicId);
                        }
                    }
                }
                var travelViewpointList = getTravelViewpointData(viewpointSelectTmp, viewpointIdArr);
                var travelHotelList = getTravelHotelData(hotelSelectTmp, hotelId);
                $(".addTravelDetailViewpoint").html(travelViewpointList);
                $(".addTravelDetailHotel").html(travelHotelList);
                $(".addTravelDetailBreakfast").val(mealInfo.breakfast);
                $(".addTravelDetailLunch").val(mealInfo.lunch);
                $(".addTravelDetailDinner").val(mealInfo.dinner);

                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                console.log(tablinks);
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById(travelDetailId).style.display = "block";
            })


            $("#travelList").on('click', '#editTravel', async function(){
                var travelId = $(this).closest("tr")
                    .attr('id');
                var travelData = await getTravelInfo(travelId);
                var travelInfo = travelData;
                $("#travelInfoModal").addClass("in");
                $(".editId").val(travelInfo.travelId);
                $(".editTravelName").val(travelInfo.travelName);
                $(".editTravelContent").val(travelInfo.travelContent);
                $(".editTravelCost").val(travelInfo.travelCost);
                $(".editTravelNum").val(travelInfo.travelNum);
                $(".editTravelDateNum").val(travelInfo.travelDateNum);
                $(".editTravelStime").val(dateTimetransfar(travelInfo.travelStime));
                $(".editTravelEtime").val(dateTimetransfar(travelInfo.travelEtime));
                $(".editTravelDetailSdate").val(travelInfo.travelDetailSdate);
                dates = travelInfo.travelDetailSdate.split(",");
                $(".editTravelDetailSdate").datepicker("refresh");
                $(".editTravelDetailSdate").val(dates.join());
                $(".editTransportationInfo").val(travelInfo.travelCostInfo.transportationInfo);
                $(".editEatInfo").val(travelInfo.travelCostInfo.eatInfo);
                $(".editLiveInfo").val(travelInfo.travelCostInfo.liveInfo);
                $(".editActionInfo").val(travelInfo.travelCostInfo.actionInfo);
                $(".editInsuranceInfo").val(travelInfo.travelCostInfo.insuranceInfo);
                $(".editNearInfo").val(travelInfo.travelCostInfo.nearInfo);
                $("#travelInfoModal").attr({ "aria-hidden": "false", style: "display:block;"});
            })

            $("#travelList").on('click', '#addTravelDetail', function () {
                var data = table.row($(this).parents('tr')).data();
                var travelId = $(this).closest("tr")
                    .attr('id');
                console.log(data.travelDateNum);
                $("#addTravelDetailModal").addClass("in");
                $("#addTravelDetailModal").attr({ "aria-hidden": "false", style: "display:block;" });

                var travelDetailInfoHtml = getTravelDatailSelectInfo(data.travelDateNum, travelId);
                $("#tabDetail").html(travelDetailInfoHtml);
            })

            $("#tabDetail").on('click', '#addTravelDayDetail', function () {
                var travelDetailTravelId = $(".travelDetailTravelId").val();
                var travelDetailTravelDay = $(".travelDetailTravelDay").val();
                var travelDetailBreakfast = $(".addTravelDetailBreakfast").val();
                var travelDetailLunch = $(".addTravelDetailLunch").val();
                var travelDetailDinner = $(".addTravelDetailDinner").val();
                var travelDetailBreakfastArr = $("input[name='travelDetailBreakfast']").map(function () {
                    return $(this).val();
                }).get();
                var travelDetailBreakfast = travelDetailBreakfastArr[travelDetailTravelDay - 1];
                var travelDetailLunchArr = $("input[name='travelDetailLunch']").map(function () {
                    return $(this).val();
                }).get();
                var travelDetailLunch = travelDetailLunchArr[travelDetailTravelDay - 1];
                var travelDetailDinnerArr = $("input[name='travelDetailDinner']").map(function () {
                    return $(this).val();
                }).get();
                var travelDetailDinner = travelDetailDinnerArr[travelDetailTravelDay - 1];
                var hotelIdArr = $("input[name='hotelIds[]']:checked").map(function () {
                    return $(this).val();
                }).get();
                var viewpointIdArr = $("input[name='viewpointIds[]']:checked").map(function () {
                    return $(this).val();
                }).get();
                var hotelIds = hotelIdArr.join(",");
                var viewpointIds = viewpointIdArr.join(",");
                $.ajax({
                    url: "@Url.Action("addTravelDayDetail", "Travel")",
                    type: "POST",
                    data: JSON.stringify({ travelId: parseInt(travelDetailTravelId), day: parseInt(travelDetailTravelDay), hotelIds: hotelIds, viewpointIds: viewpointIds, breakfast: travelDetailBreakfast, lunch: travelDetailLunch, dinner: travelDetailDinner}),
                    contentType: "application/json; charset=utf-8",
                    dataType: "JSON",
                    success: function (data) {
                        alert(data.reason);
                        //$("#addTravelDetailModal").removeClass("in");
                        //$("#addTravelDetailModal").attr({ "aria-hidden": "true", style: "display:none;"});
                        //var url = '@Url.Action("Index", "Travel")';
                        //window.location.href = url;
                    }
                })
            })

            $("#travelInfoModal").on('click', '#closeTravelEdit', function(){
                $("#travelInfoModal").removeClass("in");
                $("#travelInfoModal").attr({ "aria-hidden": "true", style: "display:none;"});
            })
            $("#addTravelModal").on('click', '#closeTravelAdd', function(){
                $("#addTravelModal").removeClass("in");
                $("#addTravelModal").attr({ "aria-hidden": "true", style: "display:none;" });
                dates = null;
            })
            $("#addTravelDetailModal").on('click', '#closeTravelDetailAdd', function () {
                $("#addTravelDetailModal").removeClass("in");
                $("#addTravelDetailModal").attr({ "aria-hidden": "true", style: "display:none;" });
            })
            $("#uploadBatchTravel").on('click', function () {
                $("#uploadBatchTravelModal").addClass("in");
                $("#uploadBatchTravelModal").attr({ "aria-hidden": "false", style: "display:block;" });
            })
            $("#uploadBatchTravelModal").on('click', '#closeBatchTravelUpload', function () {
                $("#uploadBatchTravelModal").removeClass("in");
                $("#uploadBatchTravelModal").attr({ "aria-hidden": "true", style: "display:none;" });
            })
            $("#travelInfoModal").on('click', '#updateTravel', function(){
                var travelId = $(".editId").val();
                var travelName = $(".editTravelName").val();
                var travelContent = $(".editTravelContent").val();
                var travelCost = $(".editTravelCost").val();
                var travelNum = $(".editTravelNum").val();
                var travelDateNum = $(".editTravelDateNum").val();
                var travelStime = $(".editTravelStime").val();
                var travelEtime = $(".editTravelEtime").val();
                var travelDetailSdate = $(".editTravelDetailSdate").val();
                var eatInfo = $(".editEatInfo").val();
                var liveInfo = $(".editLiveInfo").val();
                var actionInfo = $(".editActionInfo").val();
                var insuranceInfo = $(".editInsuranceInfo").val();
                var transportationInfo = $(".editTransportationInfo").val();
                var nearInfo = $(".editNearInfo").val();
                $.ajax({
                    url: "@Url.Action("updateTravelInfo","Travel")",
                    type: "POST",
                    data: JSON.stringify({ travelId: travelId, travelName: travelName, travelContent: travelContent, travelCost: travelCost, travelNum: travelNum, travelDateNum: travelDateNum, travelStime: travelStime, travelEtime: travelEtime, travelDetailSdate: travelDetailSdate, transportationInfo: transportationInfo, eatInfo: eatInfo, liveInfo: liveInfo, actionInfo: actionInfo, insuranceInfo: insuranceInfo, nearInfo: nearInfo}),
                    contentType: "application/json; charset=utf-8",
                    dataType: "JSON",
                    success: function (data) {
                        alert(data.reason);
                        if (data.success == 1) {
                            $("#travelInfoModal").removeClass("in");
                            $("#travelInfoModal").attr({ "aria-hidden": "true", style: "display:none;"});
                            var url = '@Url.Action("Index", "Travel")';
                            window.location.href = url;
                        }
                    }
                })
            })
            $("#uploadBatchTravelModal").on('click', '#uploadBatchTravel', function(){
                var data = new FormData();
                var uploadBatchViewpointFile = $(".uploadBatchTravelFile").get(0).files;
                data.append("excelFile", uploadBatchViewpointFile[0]);
                data.append("excelModule", "travel");
                $.ajax({
                    url: "@Url.Action("ImportFromExcel", "ExcelBatchUpload")",
                    type: "POST",
                    data: data,
                    dataType: "JSON",
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        alert(data.reason);
                        $("#uploadBatchTravelModal").removeClass("in");
                        $("#uploadBatchTravelModal").attr({ "aria-hidden": "true", style: "display:none;" });
                        if (data.success == 1) {
                            var url = '@Url.Action("Index", "Travel")';
                            window.location.href = url;
                        }
                    }
                })
            })

            async function getTravelDetailInfo(travelDetailId) {
                var json = "";
                await new Promise((resolve, reject) => {
                    $.ajax({
                    url: "@Url.Action("getTravelDetailInfo", "Travel")",
                    type: "POST",
                    data: JSON.stringify({ travelDetailId: travelDetailId }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "JSON",
                    success: function (data) {
                        json = data.data;
                        localStorage.setItem("getTravelDetailDetail", JSON.stringify(data.data));
                        resolve();
                    }})
                })
                return json;
            }

            async function getTravelInfo(travelId) {
                var json = "";
                await new Promise((resolve, reject) => {
                    $.ajax({
                        url: "@Url.Action("getTravelInfo", "Travel")",
                        type: "POST",
                        data: JSON.stringify({ travelId: travelId }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "JSON",
                        success: function (data) {
                            json = data.data;
                            localStorage.setItem("getTravelData", JSON.stringify(data.data));
                            resolve();
                        }
                    })
                })
                return json;
            }

            $("#travelList").on('click', '#deleteTravel', function(){
                var travelId = $(this).closest("tr")
                    .attr('id');
                $.ajax({
                    url: "@Url.Action("deleteTravel","Travel")",
                    type: "POST",
                    data: JSON.stringify({travelId: travelId}),
                    contentType: "application/json; charset=utf-8",
                    dataType: "JSON",
                    success: function (data) {
                        alert(data.reason);
                        $("#travelInfoModal").removeClass("in");
                        $("#travelInfoModal").attr({ "aria-hidden": "true", style: "display:none;"});
                        var url = '@Url.Action("Index", "Travel")';
                        window.location.href = url;
                    }
                })
            })
            $("#addTravel").on('click', function(){
                $("#addTravelModal").addClass("in");
                $("#addTravelModal").attr({ "aria-hidden": "false", style: "display:block;"});
            })
            $("#addTravelModal").on('click', '#addTravel', function(){
                var data = new FormData();
                var travelPicFile = $(".addTravelPicFile").get(0).files;
                var travelCustomBoardingIds = $("#addTravelCustomBoardingIds").val();
                var travelName = $(".addTravelName").val();
                var travelContent = $(".addTravelContent").val();
                var travelCost = $(".addTravelCost").val();
                var travelNum = $(".addTravelNum").val();
                var travelDateNum = $(".addTravelDateNum").val();
                var travelStime = $(".addTravelStime").val();
                var travelEtime = $(".addTravelEtime").val();
                var travelDetailSdate = $(".addTravelDetailSdate").val();
                var transportationInfo = $(".addTransportationInfo").val();
                var eatInfo = $(".addEatInfo").val();
                var liveInfo = $(".addLiveInfo").val();
                var actionInfo = $(".addActionInfo").val();
                var insuranceInfo = $(".addInsuranceInfo").val();
                var nearInfo = $(".addNearInfo").val();
                var travelType = $(".addTravelType").val();
                var customBoardingFlag = $(".addTravelBoardingType").val();
                data.append("travelPicFile", travelPicFile[0]);
                data.append("travelName", travelName);
                data.append("travelContent", travelContent);
                data.append("travelCost", travelCost);
                data.append("travelNum", travelNum);
                data.append("travelDateNum", travelDateNum);
                data.append("travelStime", travelStime);
                data.append("travelEtime", travelEtime);
                data.append("travelDetailSdate", travelDetailSdate);
                data.append("travelCustomBoardingIds", travelCustomBoardingIds);
                data.append("transportationInfo", transportationInfo);
                data.append("eatInfo", eatInfo);
                data.append("liveInfo", liveInfo);
                data.append("actionInfo", actionInfo);
                data.append("insuranceInfo", insuranceInfo);
                data.append("nearInfo", nearInfo);
                data.append("travelTypeId", travelType);
                data.append("travelCustomBoardingFlag", customBoardingFlag);

                $.ajax({
                    url: "@Url.Action("addTravel","Travel")",
                    type: "POST",
                    data: data,
                    dataType: "JSON",
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        alert(data.reason);
                        if (data.success == 1) {
                            $("#addTravelModal").removeClass("in");
                            $("#addTravelModal").attr({ "aria-hidden": "true", style: "display:none;"});
                            var url = '@Url.Action("Index", "Travel")';
                            window.location.href = url;
                        }
                    }
                })
            })
            $('.addTravelDetailSdate, .editTravelDetailSdate').datepicker({
                changeMonth: true,
                changeYear: true,
                showButtonPanel: true,
                dateFormat: "yy-mm-dd",
                onSelect: function (dateText, inst) {
                    addOrRemoveDate(dateText);
                    if (inst.input) {
                        inst.input.trigger('change');
                    };
                    $(".addTravelDetailSdate, .editTravelDetailSdate").val("");
                    console.log(dates);
                    $(".addTravelDetailSdate, .editTravelDetailSdate").val(dates.join());
                },
                beforeShowDay: function (date) {
                    var gotDate = $.inArray($.datepicker.formatDate($(this).datepicker('option', 'dateFormat'), date), dates);
                    if (gotDate >= 0) {
                        return [true, "ui-state-highlight", "Event Name"];
                    }
                    return [true, ""];
                }
            });
            $("#travelList").on('click', '#travelDetail', function () {
                var travelId = $(this).closest("tr")
                    .attr('id');
                top.location.href = "/TravelDetail?travelId=" + travelId;
                console.log('travelId: ', travelId);
            });

            //$(document).on("click", "#travelRow", function () {
            //    var travelId = $(this).closest("tr")
            //        .attr('id');
            //    top.location.href = "/TravelDetail?travelId=" + travelId;
            //});
        });

    </script>
    <!-- end: JavaScript-->
</body>
</html>